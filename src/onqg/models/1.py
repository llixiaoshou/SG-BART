
indexes_list = [[[3, 4, 5, 6, 7], [0, 1], [2], [8], [9, 10, 11], [13], [14, 15], [16], [17, 18, 20], [24, 25, 26, 27, 28], [21, 22], [23], [29], [30, 31], [33], [35], [34], [37], [40], [41, 42], [44, 45]
, [48, 49]], [[18, 19, 20, 21], [0, 1, 3], [5], [6, 7, 9], [12, 13], [14, 15], [17], [23], [25], [37, 38, 39], [27, 28], [30], [31, 32, 34], [36], [41], [44], [45], [46, 47], [49, 50]], [[
4, 8], [0, 1, 2], [3], [5], [7], [10], [11, 12, 14], [17, 19], [22], [31], [25], [27, 28, 29, 30, 33, 34], [26], [35], [36, 37, 38, 39]], [[3, 4, 5, 6, 7], [0, 1], [2], [8, 9, 11], [13], [
14, 15], [21, 22, 23], [17, 18, 19], [20], [24], [25, 26, 27, 29], [31], [32, 33, 34, 35, 36, 37], [41, 42], [39, 40], [53], [54, 55, 56], [57], [58, 59], [60], [64, 65], [66, 67], [43, 44
, 45, 46, 48, 49, 50]], [[1], [0], [2, 3], [5, 6], [9, 10], [14], [13], [15], [17, 18, 19, 20], [16], [21, 22, 23, 24, 25, 26], [50, 51, 52, 53], [28, 29, 30], [32], [33, 34, 36], [39, 40]
, [41, 42, 43, 44, 45, 46, 47], [49], [55], [57, 58], [60, 61], [63, 64, 65], [68, 70], [75, 76, 77, 78, 79], [72, 73], [74], [80], [82], [83, 84, 85]], [[7, 8, 9, 10, 11, 18, 19, 20, 21,
22], [0, 1, 2, 3, 4, 5], [6], [12, 13, 14, 15, 16], [25, 26, 28, 29, 30, 35], [24], [27], [31], [32, 33, 34], [36, 37, 38], [39], [40, 41], [43, 44], [57, 58, 59, 60], [46, 47, 48], [50],
[51, 52, 54], [56], [63, 64, 65, 66], [61], [62], [68, 69], [70, 71, 72, 73, 74], [75, 76, 77, 78, 79, 81], [90, 91, 92, 93], [84, 85, 87], [89], [94], [95, 96, 97, 98], [100, 101], [104]]
, [[7], [0], [2], [1], [3, 4, 5, 6], [8, 9], [11, 12], [14, 15], [18], [17, 20, 21], [24], [23, 26, 27], [29, 30], [32, 33], [35, 36], [39], [38, 41, 42], [44, 45], [47, 48], [50, 51], [64
, 65, 66], [52, 53, 54, 55], [57], [58, 59, 61], [63], [68, 69, 70], [71, 72, 73, 74, 75, 77], [86], [82, 83, 84, 85, 88, 90], [80], [81], [91, 92, 93]], [[2], [0, 1], [3, 4, 5], [7], [6],
 [8, 9, 10], [11, 12, 13, 14, 15, 16], [23, 24], [18, 19, 20, 21, 22], [25, 26, 28, 30], [32], [33, 34], [35, 36, 37, 39], [50, 51, 52, 53, 54], [41, 42], [44], [45, 46, 47], [49], [56], [
55], [57, 58, 59, 60, 61]], [[2, 3], [0, 1], [10], [11, 12, 13, 14], [15], [16], [17], [18, 19], [20, 21, 22], [23, 24, 25, 26, 27, 28], [29, 30, 31], [33, 34], [35, 37], [40], [41, 42], [
43, 44, 45, 47, 48, 49, 50, 51, 52], [4, 5, 6, 7], [77, 78, 79, 80, 81], [54, 55, 57, 58, 59], [61], [62, 63, 64], [69, 70, 71, 72, 74], [66, 67], [76], [83], [101, 102], [84], [88, 89, 90
, 91, 92, 93, 95, 96, 97], [100], [103, 104, 105, 106], [107, 108], [86], [87]], [[4, 7], [0, 1, 2, 3], [5, 6], [8, 9, 10, 11, 12, 13, 15, 16, 17], [19, 20], [41, 42], [39, 40], [22], [23,
 24, 25, 26, 27, 28, 30, 34, 35], [43, 44, 45, 46, 47], [48, 49, 50, 51, 52]], [[13], [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 11], [14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25], [26, 27, 28], [43, 44, 45, 46, 47], [30, 31, 32, 33], [37], [38], [39, 40], [42], [49], [48], [50, 51, 52], [67, 68, 69, 70], [54, 55], [57], [58], [59, 60], [61, 62, 64], [66], [72], [71], [73, 74, 75]],
 [[3, 4, 5], [0, 1, 2], [6, 7, 8], [14, 15, 16, 17], [10, 11, 12], [13], [18], [19, 20, 22], [24], [25, 26, 27, 28, 29, 30], [32, 33, 34, 35, 36], [37], [38], [40], [42], [44, 45], [47, 48
], [50], [52], [54, 55], [71], [57, 58, 59, 60, 61], [62, 63], [64, 65, 66, 67, 68, 69], [72, 73, 74], [75, 76, 77], [78, 79, 80, 81], [82, 83, 85]], [[0, 1, 2, 4, 6, 8, 10, 12, 13, 15], [
18, 19, 20, 21, 22], [17], [23], [24, 25, 27, 28, 30], [31, 32], [34, 35, 36, 38], [40, 41, 42, 43, 45, 47, 49, 51, 53, 54, 56], [59, 60, 61], [58], [62], [63, 64, 66, 67, 69], [70, 71, 72
, 73], [74, 75, 76], [78, 79], [80, 81, 82, 84, 85, 87, 88]], [[13, 14, 15, 16], [0, 1, 2, 4, 7, 9], [12], [18], [22, 23], [24, 25, 27, 28, 29, 30, 31], [32, 33], [34], [35, 36, 37], [19,
20], [42], [39, 40, 41], [43, 44, 45], [46, 47, 48, 50], [51, 52], [54, 55, 56], [57], [58], [59, 60, 61], [62, 63, 65], [66, 67, 68], [71, 76, 77], [73, 74], [75], [72], [78, 79]], [[9, 10, 11, 12, 13], [0, 1], [3], [4], [5, 6], [8], [14, 15], [16, 17, 18], [19, 20, 21], [22, 23, 24], [30, 31, 32, 33], [26, 27, 28], [29], [34, 35, 37, 38], [40], [39], [41, 42, 43, 44, 45,
46]], [[4], [0, 1, 2, 3], [5, 6, 7], [8, 11], [9, 10], [12, 13, 14], [15, 16, 17, 18], [22], [20, 21], [23, 24], [19], [25, 26, 27, 28], [40, 41, 42, 43], [30, 31, 32], [34], [35], [36, 37
], [39]], [[0, 2], [5], [7, 9, 13], [8], [10, 11, 12], [15, 17, 21, 22], [18, 19], [16], [20], [23, 25, 26, 27, 29, 30, 31, 32, 33], [35], [59], [37, 38], [43, 44, 45], [46, 47], [48, 49,
50, 51, 52, 54, 55], [56, 57, 58], [39, 40, 41], [36], [60, 61], [62, 63, 64], [66, 67, 68], [73], [70, 71], [72], [85, 86, 87, 88, 89, 90], [75, 76, 77], [78, 79, 80, 82, 83], [84], [91,
92, 93, 94], [96], [95], [97], [99, 100, 101, 102, 103, 104]], [[0, 1, 3, 5, 6, 9], [21], [20], [12], [13, 14], [15, 16, 17, 18], [22, 23, 24], [25, 26, 27, 28], [31, 32], [30], [33, 35],
[34], [36, 37, 38, 39, 40], [41, 42, 43], [45, 46], [47, 48, 49, 50, 51, 52], [53, 54, 55], [62, 63, 65, 66], [57], [58, 59], [61], [67, 68, 69, 70]], [[4, 5, 6], [0], [1, 2], [3], [7], [12], [13, 14], [16, 17], [19, 20], [22, 23], [25, 26], [28, 29], [32, 33], [8, 9, 10], [35, 36, 37, 39, 40, 44, 50, 56, 62], [78, 79, 84], [77], [80], [69, 70, 71, 72, 73, 74, 75], [82], [87], [90], [89], [91, 92, 93, 94], [100], [101, 102, 103, 104], [95, 96, 97, 98]], [[10, 11, 12, 13, 14], [0, 1, 5, 6, 7], [2, 3], [9], [15], [16, 17, 19, 21, 22], [27, 28, 30, 31, 33], [24
, 25], [26], [35, 36], [43, 44, 45], [38, 39], [41], [42], [46, 47, 48, 49], [51], [50], [52], [53], [54, 55], [57], [68, 69, 70, 71], [65, 66], [67], [59], [60, 61, 63], [73], [74, 75], [
76], [77, 78, 79, 80, 81], [83]], [[11, 12, 13], [7], [8, 9], [10], [0], [1], [2, 5], [3], [4], [14, 15, 16, 17, 18], [41, 42, 43], [20, 21], [23], [24, 25, 27], [30, 31], [32], [33, 34, 36], [35, 37, 38], [40], [45], [46, 47, 49, 50]], [[15, 16, 17], [0, 1, 2, 4, 5, 7, 9, 10, 12], [14], [19, 20], [21], [22], [23, 25, 27], [28, 29, 30], [44, 45, 46, 47], [32, 33], [35, 36,
37, 38, 39, 40, 41], [43], [49], [51, 53, 54], [52], [55, 56, 57, 58, 59, 60], [61, 62], [63, 64, 65, 66], [67, 68], [70, 71], [72, 73, 74], [75, 76], [77, 78]], [[4], [0, 1, 2], [3], [5,6, 7, 8, 9], [11], [17], [18, 19], [20, 21, 22, 23, 24, 25], [12, 13, 14, 15], [36, 37, 38], [27, 28, 29, 30, 31, 33], [35]], [[13, 14, 15], [0, 4, 10], [1], [2, 3], [5], [6], [8], [12], [
16], [17], [19, 20], [21, 22, 23], [27], [29, 30, 32, 34, 35], [40, 41], [37, 38, 39], [42, 43, 44, 45], [46, 47, 48, 49], [51, 52, 53], [54, 55, 59], [56], [58], [61, 62, 63, 64], [65, 66
, 67, 68]], [[4, 5, 6], [0, 1, 2], [3], [7, 8, 10], [13, 14, 15], [16, 17, 21], [18, 19], [34], [33], [35], [41, 42], [43, 44, 45], [46], [47], [48], [49, 50, 51, 52], [53, 54], [55, 56, 57, 58, 59], [36, 37, 38, 39], [23], [24, 25], [26, 27, 28, 29, 30, 31]], [[14, 15, 16], [0, 1, 3, 8, 9, 11], [13], [18], [20], [56, 57], [22, 23, 25, 26, 28, 29], [31], [32, 33, 35], [38,
39, 42, 43, 45, 47, 48, 49, 51], [40, 41], [55], [59], [61], [62, 63, 64, 65, 66, 67, 68]], [[2, 3], [0, 1], [20], [21, 22], [23, 24, 25, 26], [4, 5, 6], [8], [9, 10, 11, 13, 14, 15, 16, 17], [48, 49, 50, 52], [28, 29], [31], [32, 34, 36, 37, 39, 40, 42, 43, 45], [47], [55], [57, 58], [59, 60, 61], [62, 63, 64], [65, 66, 67, 68], [69, 70, 71, 72, 73, 75, 76, 77], [86, 87, 88, 89, 90], [80, 81], [82, 83, 84], [85], [91, 92, 93, 94, 95], [97, 98], [103, 104, 105, 106]], [[2, 3, 4], [0, 1], [5, 6, 7, 8], [9, 10, 11, 12, 13, 15, 16], [17, 19, 20], [22, 23, 24, 25, 26], [27, 29, 30], [31, 32], [42], [34, 35, 36, 37], [39, 40, 41], [43, 44], [45, 46]], [[3], [0, 1, 2], [4, 5], [6], [7], [9, 10], [12], [14, 15, 17], [20, 21, 22], [23, 24], [27, 28],
 [30, 31], [33, 34], [36], [38], [40], [42, 43], [46, 47, 48, 49, 50], [51, 52, 53], [59, 60], [57, 58], [55, 56], [61, 62, 64, 65, 67], [68, 70, 71, 72], [73, 74], [75], [84, 85, 86], [78
, 79, 80, 81, 82], [83], [87], [88, 89, 91, 93, 94]], [[17, 18, 19], [0], [3, 4, 5], [9, 11], [12, 13], [16], [21, 22, 23, 24, 25], [27], [28, 29], [30, 31, 32, 33], [44, 45], [41, 42, 43]
, [55, 56, 57], [54], [58, 59, 60], [61, 62, 63], [64, 65], [66, 67, 68, 69], [35, 36, 37, 38, 39], [46, 48, 49, 50]], [[3, 4], [0, 1], [2], [5, 6, 7, 8, 10, 11, 12, 13, 15, 16, 17], [31],
 [29, 30], [32, 33, 34], [36, 37], [40], [39], [41, 42, 43], [44], [45, 46, 47, 48, 49], [19], [20, 21, 22, 23, 24], [25, 26, 27], [59, 60, 61, 62, 63], [51, 52, 53, 54, 56], [58], [64, 65
, 66, 67], [69], [70, 71, 72], [73, 74, 76], [79, 80, 81], [78], [82, 83], [84, 85, 86], [88, 89], [91], [94], [108], [96], [97, 98], [99], [100], [101, 102], [104], [105, 106, 107], [109,
 110], [111], [112], [113], [115, 116], [117, 118, 119, 121, 122], [123, 124, 125, 126, 127], [129], [130, 131, 132], [133, 134], [135, 136, 137]], [[2, 3, 4], [0], [1], [5, 6, 7], [9], [10, 11, 12, 13], [14], [15, 17, 18], [34, 35], [21, 22, 30, 31], [24, 25], [26, 27, 28], [33], [36, 37, 38, 39, 40]]]

#输入对应的几句话，一句话又分为几个节点

node_sizes = [5, 2, 1, 1, 3, 1, 2, 1, 3, 5, 2, 1, 1, 2, 1, 1, 1, 1, 1, 2, 2, 2, 4, 3, 1, 3, 2, 2, 1, 1, 1, 3, 2, 1, 3, 1, 1, 1, 1, 2, 2, 2, 3, 1, 1, 1, 1, 3, 2, 1, 1, 1, 6, 1, 1, 4, 5, 2, 1,
 3, 1, 2, 3, 3, 1, 1, 4, 1, 6, 2, 2, 1, 3, 1, 2, 1, 2, 2, 7, 1, 1, 2, 2, 2, 1, 1, 1, 4, 1, 6, 4, 3, 1, 3, 2, 7, 1, 1, 2, 2, 3, 2, 5, 2, 1, 1, 1, 3, 10, 6, 1, 5, 6, 1, 1, 1, 3, 3, 1, 2, 2,
4, 3, 1, 3, 1, 4, 1, 1, 2, 5, 6, 4, 3, 1, 1, 4, 2, 1, 1, 1, 1, 1, 4, 2, 2, 2, 1, 3, 1, 3, 2, 2, 2, 1, 3, 2, 2, 2, 3, 4, 1, 3, 1, 3, 6, 1, 6, 1, 1, 3, 1, 2, 3, 1, 1, 3, 6, 2, 5, 4, 1, 2, 4,
 5, 2, 1, 3, 1, 1, 1, 5, 2, 2, 1, 4, 1, 1, 1, 2, 3, 6, 3, 2, 2, 1, 2, 9, 4, 5, 5, 1, 3, 5, 2, 1, 1, 2, 1, 9, 1, 4, 2, 1, 1, 2, 4, 2, 9, 2, 2, 2, 1, 9, 5, 5, 1, 11, 12, 3, 5, 4, 1, 1, 2, 1,
 1, 1, 3, 4, 2, 1, 1, 2, 3, 1, 1, 1, 3, 3, 3, 3, 4, 3, 1, 1, 3, 1, 6, 5, 1, 1, 1, 1, 2, 2, 1, 1, 2, 1, 5, 2, 6, 3, 3, 4, 3, 10, 5, 1, 1, 5, 2, 4, 11, 3, 1, 1, 5, 4, 3, 2, 7, 4, 6, 1, 1, 2,
 7, 2, 1, 3, 2, 1, 3, 3, 4, 2, 3, 1, 1, 3, 3, 3, 3, 2, 1, 1, 2, 5, 2, 1, 1, 2, 1, 2, 3, 3, 3, 4, 3, 1, 4, 1, 1, 6, 1, 4, 3, 2, 2, 3, 4, 1, 2, 2, 1, 4, 4, 3, 1, 1, 2, 1, 2, 1, 3, 1, 3, 4, 2
, 1, 1, 9, 1, 1, 2, 3, 2, 7, 3, 3, 1, 2, 3, 3, 1, 2, 1, 6, 3, 5, 1, 4, 1, 1, 1, 6, 6, 1, 1, 1, 2, 4, 3, 4, 2, 1, 2, 1, 5, 3, 2, 6, 3, 4, 1, 2, 1, 4, 3, 1, 2, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2,
3, 9, 3, 1, 1, 7, 1, 1, 1, 1, 4, 1, 4, 4, 5, 5, 2, 1, 1, 5, 5, 2, 1, 2, 3, 2, 1, 1, 4, 1, 1, 1, 1, 2, 1, 4, 2, 1, 1, 3, 1, 2, 1, 5, 1, 3, 1, 2, 1, 1, 1, 2, 1, 1, 5, 3, 2, 1, 3, 2, 1, 3, 3,
 1, 1, 4, 3, 9, 1, 2, 1, 1, 3, 3, 4, 2, 7, 1, 1, 3, 1, 6, 2, 4, 2, 2, 3, 2, 2, 1, 3, 1, 5, 1, 1, 2, 6, 4, 3, 6, 1, 3, 3, 1, 2, 1, 1, 1, 1, 1, 1, 2, 3, 1, 5, 2, 3, 4, 4, 3, 3, 1, 1, 4, 4, 3
, 3, 1, 3, 3, 3, 2, 1, 1, 1, 2, 3, 1, 1, 1, 4, 2, 5, 4, 1, 2, 6, 3, 6, 1, 1, 1, 2, 6, 1, 3, 9, 2, 1, 1, 1, 7, 2, 2, 1, 2, 4, 3, 1, 8, 4, 2, 1, 9, 1, 1, 2, 3, 3, 4, 8, 5, 2, 3, 1, 5, 2, 4,
3, 2, 4, 7, 3, 5, 3, 2, 1, 4, 3, 2, 2, 1, 3, 2, 1, 1, 2, 1, 3, 3, 2, 2, 2, 2, 1, 1, 1, 2, 5, 3, 2, 2, 2, 5, 4, 2, 1, 3, 5, 1, 1, 5, 3, 1, 3, 2, 2, 1, 5, 1, 2, 4, 2, 3, 3, 1, 3, 3, 2, 4, 5,
 4, 2, 2, 1, 11, 1, 2, 3, 2, 1, 1, 3, 1, 5, 1, 5, 3, 5, 5, 1, 4, 1, 3, 3, 3, 1, 2, 3, 2, 1, 1, 1, 1, 2, 1, 1, 2, 1, 3, 2, 1, 1, 1, 2, 5, 5, 1, 3, 2, 3, 3, 1, 1, 3, 1, 4, 1, 3, 2, 4, 2, 3,
1, 5]






def pad(vectors, data_length, max_length=None):
    hidden_size = (max_length, vectors.size(1))
    out = torch.zeros(hidden_size)
    # print(out.shape)
    out.narrow(0, 0, data_length).copy_(vectors)  # bag_size x rnn_enc_dim
    return out



import torch
bags = []
print(len(indexes_list))

#节点对应有多少个token
max_length = max(node_sizes)
cnt = 0
seq_output = torch.randn((32, 139, 20))
print(seq_output.shape)
for sample_idx, indexes in enumerate(indexes_list):
    # root, indexes = sample[0], sample[1]
    # for root_idx, indexes_idx in zip(root, indexes):
    for indexes_idx in indexes:
        # print(indexes_idx)
        # roots.append(seq_output[sample_idx][root_idx])
        # print(sample_idx, indexes_idx)
        # roots.append(hidden[sample_idx])
        kk = [seq_output[sample_idx][idx] for idx in indexes_idx]
        print(len(kk))
        kk = torch.stack(kk, dim=0)
        print('kk.shape', kk.shape)
        print(kk)
        bag = pad(kk, node_sizes[cnt], max_length)
        print('bag.shape', bag.shape)
        print(bag)
        bags.append(bag)
        cnt += 1
bags = torch.stack(bags, dim=0)
print('bag_batchsize', bags.shape)
# roots = torch.stack(roots, dim=0)  # all_node_num x rnn_enc_dim
#
# bags = torch.stack(bags, dim=0)  # all_node_num x bag_size x rnn_enc_dim


